<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AlphaPaw Presale</title>
  <meta name="description" content="موقع البيع المسبق لعملة AlphaPaw - تفاعل مباشر مع العقد الذكي">
  <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    body {font-family:'Almarai',sans-serif;background:#07102a;color:#e6eef6;direction:rtl;margin:0;padding:0;}
    .container{max-width:1000px;margin:auto;padding:20px;}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;}
    .logo{font-weight:700;font-size:24px;color:#7ce1b6;}
    .btn{padding:10px 16px;border:none;border-radius:8px;font-weight:700;cursor:pointer;background:#7ce1b6;color:#042025;}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.2);color:#7ce1b6;}
    .card{background:#0f1724;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 6px 20px rgba(2,6,23,0.5);}
    input{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:#e6eef6;width:100%;margin-top:6px;}
  </style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo">AlphaPaw Presale</div>
    <button class="btn secondary" id="connectBtn">اتصال بمحفظة</button>
  </header>

  <div class="card">
    <h2>شراء AlphaPaw</h2>
    <p>زر "شراء الآن" سينفذ دالة التحويل إلى محفظتك مباشرةً.</p>
    <button class="btn" id="buyBtn">شراء الآن</button>
    <div id="txResult" style="margin-top:10px;color:#7ce1b6;"></div>
  </div>

  <div class="card">
    <h3>العقد الذكي</h3>
    <p>العنوان: <code id="contractAddr">0x3064D358E45d70CD1FA04Cda6F1b48768bcb4396</code></p>
  </div>

  <footer style="text-align:center;margin-top:30px;color:#9aa4b2;">
    © <span id="year"></span> AlphaPaw. جميع الحقوق محفوظة.
  </footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/ethers@5/dist/ethers.min.js"></script>
<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  const CONTRACT_ADDRESS = '0x3064D358E45d70CD1FA04Cda6F1b48768bcb4396';
  const CONTRACT_ABI = [
	{
		"inputs":[{"internalType":"address","name":"account","type":"address"}],
		"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
		"stateMutability":"view","type":"function"
	},
	{
		"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],
		"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],
		"stateMutability":"nonpayable","type":"function"
	},
	{
		"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],
		"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],
		"stateMutability":"nonpayable","type":"function"
	}
  ];

  let provider, signer, contract;

  async function connectWallet(){
    if(!window.ethereum){ alert('MetaMask غير مثبت'); return; }
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send('eth_requestAccounts', []);
    signer = provider.getSigner();
    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
    document.getElementById('connectBtn').textContent = 'متصل';
  }

  async function buyToken(){
    if(!contract){ alert('اتصل بمحفظتك أولاً'); return; }
    try{
      const addr = await signer.getAddress();
      const amount = ethers.utils.parseUnits('100', 18); // عدّل الكمية حسب الرغبة
      const tx = await contract.transfer(addr, amount);
      document.getElementById('txResult').textContent = 'تم إرسال المعاملة: ' + tx.hash;
      await tx.wait();
      document.getElementById('txResult').textContent = 'تم تأكيد المعاملة: ' + tx.hash;
    }catch(e){
      alert('فشل تنفيذ المعاملة: ' + e.message);
      console.error(e);
    }
  }

  document.getElementById('connectBtn').addEventListener('click', connectWallet);
  document.getElementById('buyBtn').addEventListener('click', buyToken);
</script>
</body>
</html>
